# Changelog

Все значимые изменения в проекте AudioRecorder документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [семантического версионирования](https://semver.org/lang/ru/).

## [0.2.2] - 2026-01-28

### Исправлено
- **Критический краш на длинных файлах:** Решена проблема с ошибкой `-1073740791` (0xC0000409) при транскрипции аудио длительностью 60+ минут. Whisper успешно завершает транскрипцию, но крашится при cleanup (освобождение памяти pyannote/CUDA). Теперь приложение игнорирует этот краш, если выходной файл успешно создан.
- **Переполнение памяти на больших файлах:** Исправлена утечка памяти при накоплении всего вывода Whisper в `StringBuilder`. Теперь хранятся только последние 200 строк для error message.
- **Race condition при завершении процесса:** Добавлено ожидание завершения обработки stdout/stderr streams после `WaitForExitAsync` для предотвращения преждевременного возврата управления.

### Добавлено
- **Детальный прогресс транскрипции:** Отображение в реальном времени:
  - Процент выполнения
  - Скорость расшифровки (audio seconds/s)
  - Прошедшее время с начала транскрипции
  - Расчётное оставшееся время
  - Хронометраж обработанного/общего аудио
- **Статистика результатов:** После завершения транскрипции отображается:
  - Количество символов в тексте
  - Количество слов
  - Размер выходного файла (КБ)
- **Полное логирование Whisper:** Весь вывод процесса Whisper (stdout + stderr) сохраняется в файл `{имя_аудио}_whisper.log` рядом с результатом для диагностики проблем.
- **Launcher скрипты:** Добавлены `run-debug.bat`, `run-release.bat` и `build-and-run.ps1` для быстрого запуска приложения из корня проекта без навигации по вложенным директориям.

### Изменено
- **Парсинг прогресса Whisper:** Обновлён regex для корректной обработки формата вывода `faster-whisper-xxl` с флагом `-pp`:
  ```
  1% |   35/4423 | 00:01<<02:22 | 30.73 audio seconds/s
  ```
- **UI прогресса:** Упрощён интерфейс для исключения дублирования информации. Основная строка показывает процент и хронометраж, детали (прошло, скорость, осталось) выводятся отдельными полями.
- **Параметры Whisper:** Убраны экспериментальные параметры `--chunk_length` и `--compute_type`, которые вызывали краш на финализации. Добавлены флаги `-pp` (print_progress) и `--standard` для стабильного вывода.

## [0.2.1] - 2026-01-23

### Добавлено
- Редактирование транскрипции: прямое редактирование текста сегментов в UI
- Переименование спикеров через контекстное меню (ПКМ)
- Воспроизведение аудио по клику на временную метку
- Индикатор несохранённых изменений (зелёная галочка / жёлтый круг)

### Исправлено
- Парсинг транскрипции для корректной обработки временных меток
- Обрезка длинных путей в UI с добавлением tooltip

### Изменено
- Улучшена эстетика интерфейса: компактная раскладка без дублирования информации

## [0.2.0] - 2026-01-19

### Добавлено
- Базовый UI для отображения транскрипции с сегментами
- Поддержка диаризации через pyannote_v3.1
- Редактирование имён спикеров

## [0.1.0] - 2026-01-15

### Добавлено
- Запись системного звука через WASAPI loopback
- Запись микрофона
- Импорт аудиофайлов (WAV, MP3, FLAC, OGG, M4A, OPUS)
- Локальная транскрипция через faster-whisper-xxl
- Конвертация WAV в MP3 для экономии места
- Базовый WinUI 3 интерфейс
- Уведомления о завершении транскрипции
